{% extends 'base.html' %}

{% block title %}ShadeSnatch {% endblock %}

{% block content %}

        <div class="banner">
            <!-- banner intro and form button -->
            <div class="banner-intro-container">
                <div class="banner-text-container">
                    <div class="text-title">
                        <div>Welcome to</div>
                        <div id="title-name">
                            <span>ShadeSnatch</span>
                        </div>
                    </div>
                    <div class="text-heading">Uncover Colors.</div>
                    <div class="text-heading">Create Magic.</div>
                </div>
                <div class="banner-button-container">
                    <div class="text-subheading">Discover the palette in every picture by <br>uploading your image!</div>
                    <button class="banner-button" id="button">Upload Your Image</button>
                </div>
            </div>
            <!-- banner image -->
            <div class="image-container">
                <div class="image" id="image">
                    {% load static %}
                    <img src="{{ output.image_path }}" alt="Your image">
                </div>
            </div>

        </div>
    </div>
</section>

<div class="" id="modal-bg">
    <div class="form-modal" id="form-modal">
        <!-- <form action='' method="post" enctype="multipart/form-data" id="upload-form" class="form-box">
            {% csrf_token %}
            <div id="drop-zone" class="drop-zone">
                <div>
                    <i class="fa-regular fa-image" id="image-icon"></i>
                </div>
                <p>Drag & Drop your image here or <span id="file-browser">browse</span></p>
                <input type="file" id="file-input" name="image" style="display: none;">
            </div>
            <div class="submit-container">
                <button type="submit" id="submit">Submit</button>
            </div>
        </form> -->
        <form action='' method="POST" enctype="multipart/form-data" id="image-upload-form" class="form-box">
            {% csrf_token %}
            <div class="close-btn-container">
                <i class="fa-solid fa-xmark" id="close-btn"></i>
            </div>
            <div id="drop-zone" class="drop-zone">
                <div>
                    <i class="fa-regular fa-image" id="image-icon"></i>
                </div>
                <div class="form-label-input">
                    <label for="" id="label">Upload any image</label>
                <!-- <p>Drag & Drop your image here or <span id="file-browser">browse</span></p> -->
                    <input type="file" name="image" >
                <!-- <input type="file" id="file-input" name="image" required> -->
                </div>
            </div>
            <div class="submit-container">
                <button id="submit">Submit</button>
            </div>
        </form>
    </div>
</div>
    {% if output %}
<section class="color-information">
    <div class="color-info-heading">
        <div class="color-info-title">Total Extracted Colours: {{ output.total_colors }}</div>
        <div class="color-info-subtitle">Here are the 20 dominant colors we found in your image.</div>
    </div>

    <div class="colour-list" id="colour-list">
        {% for color in output.hexcodes %}
        <div class="colour-container">
            <div class="hex_codes"></div>
            <div class="hex_codes_container">
                <div class="hex" >{{color}}</div>
                <div><i class="fa-regular fa-copy copy-btn" id="copy-btn"></i></div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}


{% if output %}

<style>
    #toast-container{
        position: fixed;
        width: fit-content;
        left: 50%;
        bottom: 20px;
        transform: translateX(-50%);
    }
    .toast{
        position: relative;
        margin-top: 10px;
        background: white;
        color: black;
        padding: 15px 20px;
        scale:0.5;
        opacity: 0;
        bottom: -10px;
        animation: toast-animation 200ms ease-in-out forwards;
    }
    @keyframes toast-animation {
        to{
            scale: 1;
            opacity: 1;
            bottom: 20px;
        }
    }
    #toast-container h3{
        margin: 0;
    }


</style>

<div id="toast-container">
    
</div>

<script src="https://kit.fontawesome.com/your-font-awesome-kit.js"></script>
<script>

    // selectors
    var colorDiv = document.getElementsByClassName('hex_codes');
    var hexCodes= document.getElementsByClassName('hex');
    var toastContainer = document.getElementById('toast-container');
    let timeout = null;

    // event handlers

    for(var i=0; i<colorDiv.length; i++){

        colorDiv[i].style.height='140px';
        var color= hexCodes[i].textContent.trim();
        colorDiv[i].style.backgroundColor= color;
    }

    var copyBtn= document.getElementsByClassName('copy-btn')

    for(let i=0; i<copyBtn.length; i++){
            // var content = document.getElementById('hex').innerText;
        copyBtn[i].addEventListener('click', function(){
            var content= hexCodes[i].innerText;

            // var input = document.createElement('input');
            // input.style.position = 'fixed';
            // input.style.opacity = '0';
            // input.value = content;

            // document.body.appendChild(input);

            // input.select();

            // document.execCommand('copy');
            // document.body.removeChild(input);
            // alert('Hex Code copied to clipboard!');
            navigator.clipboard.writeText(content)
            createToast();
        })
    }

    function createToast(){
        const newToast = document.createElement("div")
        newToast.classList.add('toast');
        newToast.innerHTML = '<h3><i class="fa-solid fa-circle-check tick"></i>  Copied Successfully!</h3>';
        toastContainer.appendChild(newToast);
        newToast.animate([{scale: 0.5, opacity: 0, bottom: "-10px"}], {
            delay: 3800, duration: 200, fill: "forwards"
        })
        setTimeout(() => {
            document.removeChild(newToast);
        }, 4000)
    }

    // function createToast(){
    //     if(timeout) clearTimeout(timeout);
    //     toast.animate([{scale:1,
    //         bottom: "20px", opacity: 1}], {
    //             duration: 200, fill: "forwards"
    //         })

    //     timeout = setTimeout(() => {
    //         toast.animate([{scale:0.5,
    //         bottom: "-10px", opacity: 0}], {
    //             duration: 200, fill: "forwards"
    //         })
    //     }, 3800)
        
    // }

    var modalBg= document.getElementById('modal-bg');
    var modal= document.getElementById('form-modal');
    var form= document.getElementById('image-upload-form');
    var btn= document.getElementById('button');

    btn.addEventListener('click', openmodal)

    var closeBtn= document.getElementById('close-btn')
    closeBtn.addEventListener('click',closeModal)

    function closeModal(){
            modal.animate([
                { transform: 'translateY(0)' },
                { transform: 'translateY(-50vh)' }
            ], {
                duration: 300,
                easing: 'linear',
            });
            setTimeout(() => {
                modal.style.display="none";
                modalBg.classList.remove('modal-bg');
                form.reset();

            }, 300)
            // document.getElementById("password").innerHTML="password";
            // document.getElementById("password-length").value="";
        }

    function openmodal(){
        modal.animate([
            { transform: 'translateY(-50vh)' },
            { transform: 'translateY(0) '}
        ],{
            duration: 300,
            easing: 'linear',
        });
        setTimeout(()=>{
            modal.style.display= "block";
            modalBg.classList.add('modal-bg');
        }, 50)
    }






    // document.addEventListener('DOMContentLoaded', () => {
    // const dropZone = document.getElementById('drop-zone');
    // const fileInput = document.getElementById('file-input');
    // const fileBrowser = document.getElementById('file-browser');
    // const uploadForm = document.getElementById('upload-form');
    // const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    // // Highlight the drop zone when a file is dragged over it
    // dropZone.addEventListener('dragover', (event) => {
    //     event.preventDefault();
    //     dropZone.classList.add('dragover');
    // });

    // // Remove the highlight when the dragged file leaves the drop zone
    // dropZone.addEventListener('dragleave', () => {
    //     dropZone.classList.remove('dragover');
    // });

    // // Handle the dropped file
    // dropZone.addEventListener('drop', (event) => {
    //     event.preventDefault();
    //     dropZone.classList.remove('dragover');
    //     const files = event.dataTransfer.files;
    //     if (files.length) {
    //         fileInput.files = files;
    //         previewFile(files[0]);
    //     }
    //     console.log("files attached via drag and drop: ", fileInput.files);
    // });

    // // Open file browser when clicking the browse link
    // fileBrowser.addEventListener('click', () => {
    //     fileInput.click();
    // });

    // fileInput.addEventListener('change', () => {
    //     const files = fileInput.files;
    //     if (files.length) {
    //         previewFile(files[0]);
    //     }
    //     console.log("Files attched via upload: ",fileInput.files);
    // });

    // // Optional: Show a preview of the selected image (if desired)
    // function previewFile(file) {
    //     const reader = new FileReader();
    //     reader.onload = (event) => {
    //         const img = document.createElement('img');
    //         img.src = event.target.result;
    //         img.style.maxHeight = '180px';
    //         img.style.marginTop = '20px';
    //         dropZone.innerHTML = '';
    //         dropZone.appendChild(img);
    //     };
    //     reader.readAsDataURL(file);
    // }
    // uploadForm.addEventListener('submit', (event) => {
    //     // Optional: Add additional form validation here
    //     const files = fileInput.files;
    //     console.log("form submitted");
    //     if (!files.length) {
    //         event.preventDefault();
    //         alert("Please select an image before submitting.");
    //     }
    // });
    // uploadForm.addEventListener('submit', (event) => {
    //     event.preventDefault(); // Prevent default form submission

    //     const files = fileInput.files;
    //     if (!files.length) {
    //         alert("Please select an image before submitting.");
    //         return;
    //     }

    //     const formData = new FormData();
    //     formData.append('image', files[0]);
    //     formData.append('csrfmiddlewaretoken', csrfToken);

    //     fetch(uploadForm.action, {
    //         method: 'POST',
    //         body: formData,
    //     })
    //     .then(response => {
    //         if (!response.ok) {
    //             throw new Error(`HTTP error! status: ${response.status}`);
    //         }
    //         return response.json();
    //     })
    //     .then(data => {
    //         console.log(data);
    //         if (data.success) {
    //             alert("Image uploaded successfully.");
    //             // Optionally, you can update the UI with the response data
    //         } else {
    //             alert("Image upload failed: " + data.error);
    //         }
    //     })
    //     .catch(error => {
    //         console.error('Error:', error);
    //         alert("An error occurred during the upload.");
    //     });
    // });
// });


</script>
{% endif %}

{% endblock %}